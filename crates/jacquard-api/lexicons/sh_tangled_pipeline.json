{
  "lexicon": 1,
  "id": "sh.tangled.pipeline",
  "defs": {
    "cloneOpts": {
      "type": "object",
      "required": [
        "skip",
        "depth",
        "submodules"
      ],
      "properties": {
        "depth": {
          "type": "integer"
        },
        "skip": {
          "type": "boolean"
        },
        "submodules": {
          "type": "boolean"
        }
      }
    },
    "main": {
      "type": "record",
      "key": "tid",
      "record": {
        "type": "object",
        "required": [
          "triggerMetadata",
          "workflows"
        ],
        "properties": {
          "triggerMetadata": {
            "type": "ref",
            "ref": "#triggerMetadata"
          },
          "workflows": {
            "type": "array",
            "items": {
              "type": "ref",
              "ref": "#workflow"
            }
          }
        }
      }
    },
    "manualTriggerData": {
      "type": "object",
      "properties": {
        "inputs": {
          "type": "array",
          "items": {
            "type": "ref",
            "ref": "#pair"
          }
        }
      }
    },
    "pair": {
      "type": "object",
      "required": [
        "key",
        "value"
      ],
      "properties": {
        "key": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      }
    },
    "pullRequestTriggerData": {
      "type": "object",
      "required": [
        "sourceBranch",
        "targetBranch",
        "sourceSha",
        "action"
      ],
      "properties": {
        "action": {
          "type": "string"
        },
        "sourceBranch": {
          "type": "string"
        },
        "sourceSha": {
          "type": "string",
          "minLength": 40,
          "maxLength": 40
        },
        "targetBranch": {
          "type": "string"
        }
      }
    },
    "pushTriggerData": {
      "type": "object",
      "required": [
        "ref",
        "newSha",
        "oldSha"
      ],
      "properties": {
        "newSha": {
          "type": "string",
          "minLength": 40,
          "maxLength": 40
        },
        "oldSha": {
          "type": "string",
          "minLength": 40,
          "maxLength": 40
        },
        "ref": {
          "type": "string"
        }
      }
    },
    "triggerMetadata": {
      "type": "object",
      "required": [
        "kind",
        "repo"
      ],
      "properties": {
        "kind": {
          "type": "string",
          "enum": [
            "push",
            "pull_request",
            "manual"
          ]
        },
        "manual": {
          "type": "ref",
          "ref": "#manualTriggerData"
        },
        "pullRequest": {
          "type": "ref",
          "ref": "#pullRequestTriggerData"
        },
        "push": {
          "type": "ref",
          "ref": "#pushTriggerData"
        },
        "repo": {
          "type": "ref",
          "ref": "#triggerRepo"
        }
      }
    },
    "triggerRepo": {
      "type": "object",
      "required": [
        "knot",
        "did",
        "repo",
        "defaultBranch"
      ],
      "properties": {
        "defaultBranch": {
          "type": "string"
        },
        "did": {
          "type": "string",
          "format": "did"
        },
        "knot": {
          "type": "string"
        },
        "repo": {
          "type": "string"
        }
      }
    },
    "workflow": {
      "type": "object",
      "required": [
        "name",
        "engine",
        "clone",
        "raw"
      ],
      "properties": {
        "clone": {
          "type": "ref",
          "ref": "#cloneOpts"
        },
        "engine": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "raw": {
          "type": "string"
        }
      }
    }
  }
}